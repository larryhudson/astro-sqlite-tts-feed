---
import {createArticle} from "../../../tasks/createArticle"
import {getArticles} from "../../utils/db"


if (Astro.request.method === "POST") {
  console.log("posting!");
  const formData = await Astro.request.formData();
  const { title, url } = Object.fromEntries(formData.entries());
  await createArticle({title, url}) 
}
const articles = getArticles();
---

<h1>Articles</h1>
<table>
  <thead>
    <tr>
      <th>Title</th>
      <th>URL</th>
      <th>Audio</th>
    </tr>
  </thead>
  <tbody>
    {
      articles.map((article) => (
        <tr>
          <td>{article.title}</td>
          <td>{article.url}</td>
          <td>
            {article.mp3Url ? (
              <audio controls>
                <source src={article.mp3Url} type="audio/mpeg" />
              </audio>
            ) : (
              <form method="POST" action={`/articles/${article.id}/audio`}>
                <button type="submit">Get audio</button>
              </form>
            )}
          </td>
        </tr>
      ))
    }
  </tbody>
</table>

<h2>Add new</h2>
<form method="POST">
  <label>
    Title
    <input type="text" name="title" />
  </label>
  <label>
    URL
    <input type="text" name="url" />
  </label>
  <button type="submit">Add</button>
</form>
